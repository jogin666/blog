## CAP理论

在分布式系统中，将一个业务拆分成多个子业务，而一个子业务被称之为一个节点。在浏览分布式的文章中文章

中，发现蛮多文章都是会讲到CAP理论，遂而也来写一篇。

**CAP分别代表什么东西**

* C  (Consistency) ：数据的一致性，让分布式的所有节点拥有的数据都是最新版本。
* A  (Availability) ：可用性，数据操作的可用性，即可以相应处理请求。
* p  (partition-tolerance) ：分区容错性，容忍网络造成出现分区，分区之间不能通信。

**CAP理论介绍**

对于CAP理论，个人觉得先应该从可用性开始讲起。 在分布式中，为了防止节点宕机，服务雪崩，一般都会使用

节点集群，当某个节点出现了宕机，可以将请求转发给集群中的其他节点处理，保证分布式的可用性。而为了保证

可用性，于是出现新的问题，数据的一致性，因为集群节点有可能使用不同的数据库（负载均衡）。要保证数据的

一致性，就需要集群的节点之间相互通信，及时更新数据，保持集群节点之间的数据一致性。

![CAP1](https://github.com/jogin666/blog/blob/master/resource/%E5%88%86%E5%B8%83%E5%BC%8F%E5%92%8C%E6%9C%8D%E5%8A%A1%E5%8C%96%E6%A6%82%E5%BF%B5/images/CAP1.png)

对于分区容错性，先讲一下分区吧。在分布式系统中，当有些节点不能互相通信时（网络出现异常），集群的节点

就出现了网络分区，数据分散在不联通的网络区域上（节点不能通信，交互彼此的最新数据），这就是分布式定义

的分区。

![CAP2](https://github.com/jogin666/blog/blob/master/resource/%E5%88%86%E5%B8%83%E5%BC%8F%E5%92%8C%E6%9C%8D%E5%8A%A1%E5%8C%96%E6%A6%82%E5%BF%B5/images/CAP2.png)



分区容错性：就是保证集群之间尽量多的节点保持数据的一致性。为什么说尽量多呢？ 当集群节点之的某个节点

出现网络异常时（就是节点之间不能进行网络通信），数据不能更新，但保证可以通信的节点之间要交互数据，将

数据更新到其他的可互相通信的节点上，尽最大努力保证系统的可用性（请求获取最新的数据）。而要提高分区容

错性的办法就是一个数据项复制到多个节点上，在出现分区时，尽量让数据项就可能分布到各个区里，那系统的容

错性就提高了。然而提高分区容错性机会带来数据一致性的问题（要把数据更新到所有节点中）。要保证数据的一

致性，就要将某个节点的数据修改操作全部成功写入到其他节点中，而这等待又会带来可用性的问题（服务端阻

塞，不能及时处理请求）。总的来说就是：集群节点越多，系统的容错性越高，可用性就越高，而集群节点预期，

越难保证数据的一致性，包保证数据的一致性，就会带来可用性问题。

视同图二，举个不恰当的例子，当有一个请求来到节点1时，该请求要求向数据库表中增加一条记录。那节点1是

否要处理一个请求，如果处理，就一牺牲数据的一致性保证可用性，不处理，则牺牲可用性来保证数据的一致性。



**CAP理论总结**

在分布式系统中哪那个，分区容错性是必须的，为可用性提供一定保证。如同上述所言，CAP理论是无法完全兼顾

的，兼顾了CP，就无法兼顾AP，反之亦然。但不是说，要CP，就不要A了，或者要AP就抛弃C了，而是要再做出

取舍之后，尽可能保证优化舍的哪一方，提高其性能。其实所谓的无法兼顾是有一定准则的，因为一致性是级别区

分的，比如说，银行账单，可定是舍弃一定的可用性来保证数据的一致性的，这是数据的强制一致性。而银行的另

外一部分数据（譬如银行的总客户数）并不要求强一致性，只要最终保持数据的一致性（一定时间之后），这是数

据的最终一致性。当然啦，还有数据的弱一致性，弱一致性是相对于强一致性而言，它不保证总能得到最新的值。

总的来说：**CAP理论定义的其实是在容忍网络分区的条件下，“强一致性”和“极致可用性”无法同时达到**。



参考资料：

<a href="https://www.zhihu.com/question/54105974">CAP理论中的P到底是个什么意思？</a>

<a href="https://m.aliyun.com/yunqi/articles/2709">浅谈分布式系统的基本问题：可用性与一致性</a>

<a href="https://mp.weixin.qq.com/s?__biz=MzI4Njg5MDA5NA==&mid=2247484335&idx=1&sn=a871bf871fcaffda0be40e1388a69d7d&chksm=ebd742aedca0cbb8e22138fa7488cb80ee09a5b5d7aa065679904005c609e92a0d9ad755a913&token=620000779&lang=zh_CN&scene=21###wechat_redirect">外行人都能看懂的SpringCloud，错过了血亏！</a>
